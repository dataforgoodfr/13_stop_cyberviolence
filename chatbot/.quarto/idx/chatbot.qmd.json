{"title":"Data for Good Saison 13 - Stop Cyber","markdown":{"yaml":{"title":"Data for Good Saison 13 - Stop Cyber","subtitle":"Chatbot development","format":{"gfm":{"output-ext":"md","output-file":"README"}}},"headingText":"Cahier de charges","containsRefs":false,"markdown":"\n\n\n## Prospective design\n\n```{mermaid}\n%%| collapse: true\nstateDiagram-v2\n  u: User input\n  a1: Agent service 1\n  r1: Research assistant\n  class1: classifier\n\n\n  u --> a1\n  a1 --> u : context questions\n  a2 --> u : interaction\n\n  a1 --> a2 : handoff\nService1 --> Service2 : Cyberviolence detection\n\nstate Service1 {\n  a1 --> r1\n  r1 --> a1\n  a1 --> class1\n  class1 --> a1\n}\n\n\nstate Service2{\n  a2: Agent service 2\n  r2: Research assistant\n\n  a2 --> r2\n  r2 --> a2\n}\n\n\nService2 --> Service3 : referral to specialized service necessary\n\na2 --> a3 : handoff\na3 --> u : interaction\n\nstate Service3 {\n  a3: Agent Service 3\n  r3: Research assistant 3\n\n  a3 --> r3\n  r3 --> a3\n}\n\nend : End\n\nService3 --> end\n```\n\n# Update 03/04/2025\n\n## Implementation\n\nJ'ai choisi `langgraph` en combinaison avec `langchain`. Les deux sont open-source, avec une documentation extensive et de nombreux tutoriels disponibles.\n\nPour un premier draft, je me suis inspiré (entre autres) de cet [article](https://ai.gopubby.com/building-rag-research-multi-agent-with-langgraph-1bd47acac69f).\n\nPour le premier draft, nous nous concentrons sur le service 1 \"Aide à la réponse\".\n\nLe modèle utilisé est ~~`GPT-4o-mini` de `OpenAI`sans raison spécifique.~~ `Gemini 2.0 Flash` pour sa fenêtre de contexte très large.\nAvec `GPT-4o-mini`, on arrivait déjà à la limite ce qui reste suspicieux (code à vérifier).\nLes calls de API passe maintenant par `OpenRouter`, cela permet de facilement changer les modèles pour un prototypage rapide.\nPotentiellement, on pourra envisager d'utiliser différents modèles pour différents tâches.\n\n**État actuel** \n\n![](./graph.png)\n\nLe routage fonctionne (par exemple, \"je me sens en danger\" active la voie 'escalate'), à vérifier en language ados. \n\n~~Pour l'instant, j'ai l'impression que nous devons forcer l'agent à solliciter le RESEARCHER ou le CLASSIFIER (du genre à demander directement).~~\n\nChaque node a un prompt qui reste à definir/améliorer.\n\n**TODO**\n\n### Agent\n\n- [x] Le début de l'échange doit être amélioré (le bot doit se présenter et préparer le terrain).\n- [x] `agent1` doit probablement etre converti en simple point de routage \n- [x] definition des informations contextuelle minimales\n\n### Situational context\n\nPour bien comprendre la situation qui a conduit le jeune / ado à soliciter le chatbot, on a besoin des infos suivants:\n\n- Rôle du jeune: Expéditeur (potentitiel), destinataire ou témoin\n- Le canal de communication par lequel le message est arrivé chez le jeune\n- Le ressenti que le message a évoqué\n\n**Implementation**\n\nDeux solutions semblent envisageables:\n\n1. [x] Séries des questions déterminstes au début de l'échange, les infos sont enregistré dans dictionnaire\n2. [ ] Défintion d'un dictionnaire avec des champs prédefinis, la collecte des informations est laissé au LLM\n\nDans les deux cas, les informations devront être injectés dans les system prompts. \n\n### RAG pour `research_strategies`\n\nOn part pour une exploration de [`kotaemon`](https://github.com/Cinnamon/kotaemon/tree/main), \nun open-source RAG tool. Ce qui sera probablement le plus intéressant, sont\nles procédures de traitement des documents, les embeddings, le stockage et le retrieval.\n\nEst-ce qu'on ne garderait pqs l'UI `kotaemon` pour la gestion des documents ?\n\n- [ ] Liste des documents à ingérer\n- [ ] Quel vectorstore ?\n- [ ] Procédure de retrieval des informations.\n\n### NLP message classifier (priorite moindre)\n\n- [ ] Modèle de classification du dataset [`cyberagressionado-v1`](https://hatespeechdata.com/#cyberagressionado-v1).\n- [ ] Procédure pour que CLASSIFIER1 puisse se servir du modèle de classification (peut-être ce sera plutôt un outil pour AGENT1 qu'un agent spécialisé).\n\n### Interface graphique\n\n- [x] Interface graphique de base en place, implementé avec `chainlit`\n- [x] support envoi capture d'ecran\n- [ ] Customisation ....\n\n<details>\n<summary>**Exemple d'un échange**</summary>\n\n```\nEnter your query (type '-q' to quit):\n> ================================== Ai Message ==================================\n\nI understand that you're feeling upset about what happened. It's really important to talk about it. Can you tell me more about what was said or done? This will help me understand the situation better.\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\nhi, est-ce qu'on peut discuter en francais ?\n\n================================== Ai Message ==================================\n\nBien sûr, nous pouvons discuter en français ! Je suis là pour t'aider. Peux-tu me dire ce qui te préoccupe ?\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\nj'ai recu un message de qqn que je connais pas vraiment. je comprends pas trop ce que ca veut dire\n\n================================== Ai Message ==================================\n\nJe comprends que recevoir un message d'une personne que tu ne connais pas peut être déroutant et même un peu inquiétant. Peux-tu me dire ce que le message disait ? Cela m'aidera à mieux comprendre la situation et à te donner des conseils appropriés.\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\nil m'a dit que je suis moche\n\n================================== Ai Message ==================================\n\nJe suis vraiment désolé d'apprendre que tu as reçu un message aussi blessant. C'est très injuste et tu ne mérites pas d'être traité de cette façon. Les commentaires comme celui-ci sont une forme de cyberharcèlement, et c'est important de se rappeler que ce n'est pas de ta faute.\n\nVoici quelques étapes que tu peux suivre :\n1. **Ne réponds pas** à ce message. Parfois, ignorer les personnes qui essaient de te blesser est la meilleure chose à faire.\n2. **Prends une capture d'écran** du message pour garder une preuve de ce qui a été dit.\n3. **Bloque la personne** sur la plateforme où tu as reçu le message. Cela peut t'aider à te sentir plus en sécurité.\n4. **Parle-en à un adulte de confiance**, comme un parent, un enseignant ou un conseiller scolaire. Ils peuvent t'aider à gérer la situation.\n\nN'oublie pas que tu n'es pas seul et qu'il y a des gens qui se soucient de toi et qui peuvent t'aider. Tu es précieux et tu mérites d'être traité avec respect !\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\ntu me conseilles de faire quoi?\n\n================================== Ai Message ==================================\n\nJe te conseille de suivre ces étapes :\n\n1. **Ne réponds pas** au message. Ignorer les personnes qui essaient de te blesser est souvent la meilleure option.\n2. **Prends une capture d'écran** du message pour garder une preuve de ce qui a été dit. Cela peut être utile si tu en parles à un adulte.\n3. **Bloque la personne** sur la plateforme où tu as reçu le message. Cela peut t'aider à te sentir plus en sécurité et à éviter d'autres messages blessants.\n4. **Parle-en à un adulte de confiance**, comme un parent, un enseignant ou un conseiller scolaire. Ils peuvent t'aider à gérer la situation et à te soutenir.\n\nN'oublie pas que tu n'es pas seul et qu'il y a des gens qui se soucient de toi et qui peuvent t'aider. Tu es précieux et tu mérites d'être traité avec respect !\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\ntu crois que c'est du cyberharcelement?\n\n================================== Ai Message ==================================\n\nOui, ce que tu as décrit ressemble à du cyberharcèlement. Quand quelqu'un t'envoie des messages blessants ou méchants, cela fait partie des comportements de harcèlement en ligne. C'est important de se rappeler que ce n'est pas de ta faute et que tu ne mérites pas d'être traité de cette manière.\n\nSi tu veux, je peux t'aider à prendre des mesures pour te protéger et te sentir mieux. Que souhaites-tu faire ?\n\n---\n Routed to:  CLASSIFIER1\n---\n\n================================== Ai Message ==================================\n\nClearly cyberviolence\n\n================================== Ai Message ==================================\n\nJe pense qu'il est important de prendre cette situation au sérieux. Étant donné que tu as reçu un message blessant et que cela ressemble à du cyberharcèlement, je vais transférer ton cas à un service spécialisé qui pourra t'aider davantage. Ils pourront te fournir le soutien dont tu as besoin.\n\nN'oublie pas que tu n'es pas seul et qu'il y a des gens qui se soucient de toi. Je vais maintenant te transférer à ce service.\n\n---\n Routed to:  SERVICE2\n---\n\n================================== Ai Message ==================================\n\nService 2 not yet implemented\n\n\n```\n\n</details>\n\n\n","srcMarkdownNoYaml":"\n\n# Cahier de charges\n\n## Prospective design\n\n```{mermaid}\n%%| collapse: true\nstateDiagram-v2\n  u: User input\n  a1: Agent service 1\n  r1: Research assistant\n  class1: classifier\n\n\n  u --> a1\n  a1 --> u : context questions\n  a2 --> u : interaction\n\n  a1 --> a2 : handoff\nService1 --> Service2 : Cyberviolence detection\n\nstate Service1 {\n  a1 --> r1\n  r1 --> a1\n  a1 --> class1\n  class1 --> a1\n}\n\n\nstate Service2{\n  a2: Agent service 2\n  r2: Research assistant\n\n  a2 --> r2\n  r2 --> a2\n}\n\n\nService2 --> Service3 : referral to specialized service necessary\n\na2 --> a3 : handoff\na3 --> u : interaction\n\nstate Service3 {\n  a3: Agent Service 3\n  r3: Research assistant 3\n\n  a3 --> r3\n  r3 --> a3\n}\n\nend : End\n\nService3 --> end\n```\n\n# Update 03/04/2025\n\n## Implementation\n\nJ'ai choisi `langgraph` en combinaison avec `langchain`. Les deux sont open-source, avec une documentation extensive et de nombreux tutoriels disponibles.\n\nPour un premier draft, je me suis inspiré (entre autres) de cet [article](https://ai.gopubby.com/building-rag-research-multi-agent-with-langgraph-1bd47acac69f).\n\nPour le premier draft, nous nous concentrons sur le service 1 \"Aide à la réponse\".\n\nLe modèle utilisé est ~~`GPT-4o-mini` de `OpenAI`sans raison spécifique.~~ `Gemini 2.0 Flash` pour sa fenêtre de contexte très large.\nAvec `GPT-4o-mini`, on arrivait déjà à la limite ce qui reste suspicieux (code à vérifier).\nLes calls de API passe maintenant par `OpenRouter`, cela permet de facilement changer les modèles pour un prototypage rapide.\nPotentiellement, on pourra envisager d'utiliser différents modèles pour différents tâches.\n\n**État actuel** \n\n![](./graph.png)\n\nLe routage fonctionne (par exemple, \"je me sens en danger\" active la voie 'escalate'), à vérifier en language ados. \n\n~~Pour l'instant, j'ai l'impression que nous devons forcer l'agent à solliciter le RESEARCHER ou le CLASSIFIER (du genre à demander directement).~~\n\nChaque node a un prompt qui reste à definir/améliorer.\n\n**TODO**\n\n### Agent\n\n- [x] Le début de l'échange doit être amélioré (le bot doit se présenter et préparer le terrain).\n- [x] `agent1` doit probablement etre converti en simple point de routage \n- [x] definition des informations contextuelle minimales\n\n### Situational context\n\nPour bien comprendre la situation qui a conduit le jeune / ado à soliciter le chatbot, on a besoin des infos suivants:\n\n- Rôle du jeune: Expéditeur (potentitiel), destinataire ou témoin\n- Le canal de communication par lequel le message est arrivé chez le jeune\n- Le ressenti que le message a évoqué\n\n**Implementation**\n\nDeux solutions semblent envisageables:\n\n1. [x] Séries des questions déterminstes au début de l'échange, les infos sont enregistré dans dictionnaire\n2. [ ] Défintion d'un dictionnaire avec des champs prédefinis, la collecte des informations est laissé au LLM\n\nDans les deux cas, les informations devront être injectés dans les system prompts. \n\n### RAG pour `research_strategies`\n\nOn part pour une exploration de [`kotaemon`](https://github.com/Cinnamon/kotaemon/tree/main), \nun open-source RAG tool. Ce qui sera probablement le plus intéressant, sont\nles procédures de traitement des documents, les embeddings, le stockage et le retrieval.\n\nEst-ce qu'on ne garderait pqs l'UI `kotaemon` pour la gestion des documents ?\n\n- [ ] Liste des documents à ingérer\n- [ ] Quel vectorstore ?\n- [ ] Procédure de retrieval des informations.\n\n### NLP message classifier (priorite moindre)\n\n- [ ] Modèle de classification du dataset [`cyberagressionado-v1`](https://hatespeechdata.com/#cyberagressionado-v1).\n- [ ] Procédure pour que CLASSIFIER1 puisse se servir du modèle de classification (peut-être ce sera plutôt un outil pour AGENT1 qu'un agent spécialisé).\n\n### Interface graphique\n\n- [x] Interface graphique de base en place, implementé avec `chainlit`\n- [x] support envoi capture d'ecran\n- [ ] Customisation ....\n\n<details>\n<summary>**Exemple d'un échange**</summary>\n\n```\nEnter your query (type '-q' to quit):\n> ================================== Ai Message ==================================\n\nI understand that you're feeling upset about what happened. It's really important to talk about it. Can you tell me more about what was said or done? This will help me understand the situation better.\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\nhi, est-ce qu'on peut discuter en francais ?\n\n================================== Ai Message ==================================\n\nBien sûr, nous pouvons discuter en français ! Je suis là pour t'aider. Peux-tu me dire ce qui te préoccupe ?\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\nj'ai recu un message de qqn que je connais pas vraiment. je comprends pas trop ce que ca veut dire\n\n================================== Ai Message ==================================\n\nJe comprends que recevoir un message d'une personne que tu ne connais pas peut être déroutant et même un peu inquiétant. Peux-tu me dire ce que le message disait ? Cela m'aidera à mieux comprendre la situation et à te donner des conseils appropriés.\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\nil m'a dit que je suis moche\n\n================================== Ai Message ==================================\n\nJe suis vraiment désolé d'apprendre que tu as reçu un message aussi blessant. C'est très injuste et tu ne mérites pas d'être traité de cette façon. Les commentaires comme celui-ci sont une forme de cyberharcèlement, et c'est important de se rappeler que ce n'est pas de ta faute.\n\nVoici quelques étapes que tu peux suivre :\n1. **Ne réponds pas** à ce message. Parfois, ignorer les personnes qui essaient de te blesser est la meilleure chose à faire.\n2. **Prends une capture d'écran** du message pour garder une preuve de ce qui a été dit.\n3. **Bloque la personne** sur la plateforme où tu as reçu le message. Cela peut t'aider à te sentir plus en sécurité.\n4. **Parle-en à un adulte de confiance**, comme un parent, un enseignant ou un conseiller scolaire. Ils peuvent t'aider à gérer la situation.\n\nN'oublie pas que tu n'es pas seul et qu'il y a des gens qui se soucient de toi et qui peuvent t'aider. Tu es précieux et tu mérites d'être traité avec respect !\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\ntu me conseilles de faire quoi?\n\n================================== Ai Message ==================================\n\nJe te conseille de suivre ces étapes :\n\n1. **Ne réponds pas** au message. Ignorer les personnes qui essaient de te blesser est souvent la meilleure option.\n2. **Prends une capture d'écran** du message pour garder une preuve de ce qui a été dit. Cela peut être utile si tu en parles à un adulte.\n3. **Bloque la personne** sur la plateforme où tu as reçu le message. Cela peut t'aider à te sentir plus en sécurité et à éviter d'autres messages blessants.\n4. **Parle-en à un adulte de confiance**, comme un parent, un enseignant ou un conseiller scolaire. Ils peuvent t'aider à gérer la situation et à te soutenir.\n\nN'oublie pas que tu n'es pas seul et qu'il y a des gens qui se soucient de toi et qui peuvent t'aider. Tu es précieux et tu mérites d'être traité avec respect !\n\n---\n Routed to:  USER\n---\n\n> : ================================ Human Message =================================\n\ntu crois que c'est du cyberharcelement?\n\n================================== Ai Message ==================================\n\nOui, ce que tu as décrit ressemble à du cyberharcèlement. Quand quelqu'un t'envoie des messages blessants ou méchants, cela fait partie des comportements de harcèlement en ligne. C'est important de se rappeler que ce n'est pas de ta faute et que tu ne mérites pas d'être traité de cette manière.\n\nSi tu veux, je peux t'aider à prendre des mesures pour te protéger et te sentir mieux. Que souhaites-tu faire ?\n\n---\n Routed to:  CLASSIFIER1\n---\n\n================================== Ai Message ==================================\n\nClearly cyberviolence\n\n================================== Ai Message ==================================\n\nJe pense qu'il est important de prendre cette situation au sérieux. Étant donné que tu as reçu un message blessant et que cela ressemble à du cyberharcèlement, je vais transférer ton cas à un service spécialisé qui pourra t'aider davantage. Ils pourront te fournir le soutien dont tu as besoin.\n\nN'oublie pas que tu n'es pas seul et qu'il y a des gens qui se soucient de toi. Je vais maintenant te transférer à ce service.\n\n---\n Routed to:  SERVICE2\n---\n\n================================== Ai Message ==================================\n\nService 2 not yet implemented\n\n\n```\n\n</details>\n\n\n"},"formats":{"gfm":{"identifier":{"display-name":"Github (GFM)","target-format":"gfm","base-format":"gfm"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"png","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":false,"output-ext":"md","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"variant":"+autolink_bare_uris+emoji+footnotes+gfm_auto_identifiers+pipe_tables+strikeout+task_lists+tex_math_dollars"},"pandoc":{"standalone":true,"default-image-extension":"png","to":"commonmark","output-file":"README"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"title":"Data for Good Saison 13 - Stop Cyber","subtitle":"Chatbot development"}}},"projectFormats":["html"]}